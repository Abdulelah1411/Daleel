# -*- coding: utf-8 -*-
"""Daleel_Hakthon.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/18DrxS9qED6aed3bWYoMmyOOaIql0UVt5
"""

from google.colab import drive
drive.mount('/content/drive')

!pip install openpyxl
import pandas as pd

# Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù…Ù„ÙÙƒ ÙÙŠ Ø§Ù„Ø¯Ø±Ø§ÙŠÙ
file_path = '/content/drive/MyDrive/Hakathon/Enhanced_Final_Team_Data.xlsx'

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ù Excel
df = pd.read_excel(file_path)

# Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 5 Ø£Ø³Ø·Ø± Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­
df.head()

!pip install openpyxl

# prompt: write code to understand the data in exscl

# Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
df.info()

# Ø¹Ø±Ø¶ Ø¨Ø¹Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙˆØµÙÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
df.describe()

# Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ÙØ±ÙŠØ¯Ø© Ù„ÙƒÙ„ Ø¹Ù…ÙˆØ¯
for column in df.columns:
  print(f"Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ÙØ±ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ '{column}': {df[column].nunique()}")

# Ø¹Ø±Ø¶ Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ÙØ±ÙŠØ¯Ø© Ù…Ù† ÙƒÙ„ Ø¹Ù…ÙˆØ¯
for column in df.columns:
  print(f"Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ÙØ±ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ '{column}': {df[column].unique()[:10]}")


# ØªØ­Ù„ÙŠÙ„ ØªÙˆØ²ÙŠØ¹ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© (Ù…Ø«Ø§Ù„)
import matplotlib.pyplot as plt
import seaborn as sns

import pandas as pd

# Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ (Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù…Ø³Ø§Ø± Ø­Ø³Ø¨ Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ù„Ù Ù„Ø¯ÙŠÙƒ)
file_path = '/content/drive/MyDrive/Hakathon/Enhanced_Final_Team_Data.xlsx'

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙˆØ±Ù‚ØªÙŠÙ† "Points" Ùˆ "Details"
df_points = pd.read_excel(file_path, sheet_name='Points')
df_details = pd.read_excel(file_path, sheet_name='Details')

# Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
print(df_points.head())
print(df_details.head())

# ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
!pip install pandas openpyxl

# Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
import pandas as pd
from openpyxl import load_workbook

# Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù„Ù
file_path = '/content/drive/MyDrive/Hakathon/Enhanced_Final_Team_Data.xlsx'

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙˆØ±Ù‚ØªÙŠÙ† (Points Ùˆ Details)
df_points = pd.read_excel(file_path, sheet_name='Points')
df_details = pd.read_excel(file_path, sheet_name='Details')

# Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù† Points
points_cols = [
    'Match ID', 'Team', 'Player', 'Position', 'Rank', 'Points', 'Minutes played',
    'Goals 10', 'Shots on target 4', 'Shots off target 2', 'Interceptions 2',
    'Fouls won 1', 'Fouls conceded -1', 'Offsides -1', 'Yellow cards -2',
    'Red cards -5', 'Goals conceded (Player=-1, GK=-6)',
    'Penalties won 4', 'Saves (Player=0, GK=5)', 'Penalties saved (Player=0, GK=5)'
]

# Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù† Details
details_cols = [
    'Match ID', 'Player', 'Accurate Passes', 'Hit woodwork', 'Shots inside the box',
    'Shots outside the box', 'Headed shots', 'Expected goals', 'Goal kick', 'Throw ins',
    'Goals outside the box', 'Right foot goals', 'Left foot goals', 'Headed goals',
    'Penalty goals', 'Direct free kick goals', 'Season'
]

# Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
df_points_filtered = df_points[points_cols]
df_details_filtered = df_details[details_cols]

# Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Match ID Ùˆ Player
df_merged = pd.merge(df_points_filtered, df_details_filtered,
                     on=['Match ID', 'Player'],
                     how='left')

# Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ù…Ø¬
print(df_merged.head())

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ù† Ø£Ø¬Ù„ Ø­ÙØ¸ Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
book = load_workbook(file_path)

# Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø´ÙŠØª Ø¬Ø¯ÙŠØ¯ Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ
with pd.ExcelWriter(file_path, engine='openpyxl', mode='a', if_sheet_exists='replace') as writer:
    df_merged.to_excel(writer, sheet_name='Player_Performance_Merged', index=False)

print("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ ÙÙŠ ÙˆØ±Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©.")

"""Ø§ÙƒØªØ´ÙÙ†Ø§ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ© .. Ù†Ø³Ø¹Ù‰ Ø§Ù„Ù‰ Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙˆØ­Ù„Ù‡Ø§

"""

import pandas as pd

# Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ (Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù…Ø³Ø§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø®ØªÙ„ÙÙ‹Ø§)
file_path = '/content/drive/MyDrive/Hakathon/Enhanced_Final_Team_Data.xlsx'

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙˆØ±Ù‚ØªÙŠÙ† (Points Ùˆ Details)
df_points = pd.read_excel(file_path, sheet_name='Points')
df_details = pd.read_excel(file_path, sheet_name='Details')

# Ø¹Ø±Ø¶ Ø³Ø±ÙŠØ¹ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
print("Points data:", df_points.head())
print("Details data:", df_details.head())

# ØªÙ†Ø¸ÙŠÙ Match ID Ùˆ Player ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ÙŠÙ† Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ·Ø§Ø¨Ù‚
df_points['Match ID'] = df_points['Match ID'].astype(str).str.strip()
df_points['Player'] = df_points['Player'].astype(str).str.strip().str.lower()

df_details['Match ID'] = df_details['Match ID'].astype(str).str.strip()
df_details['Player'] = df_details['Player'].astype(str).str.strip().str.lower()

# Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù† Points
points_cols = [
    'Match ID', 'Team', 'Player', 'Position', 'Rank', 'Points', 'Minutes played',
    'Goals 10', 'Shots on target 4', 'Shots off target 2', 'Interceptions 2',
    'Fouls won 1', 'Fouls conceded -1', 'Offsides -1', 'Yellow cards -2',
    'Red cards -5', 'Goals conceded (Player=-1, GK=-6)',
    'Penalties won 4', 'Saves (Player=0, GK=5)', 'Penalties saved (Player=0, GK=5)'
]

# Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù† Details
details_cols = [
    'Match ID', 'Player', 'Accurate Passes', 'Hit woodwork', 'Shots inside the box',
    'Shots outside the box', 'Headed shots', 'Expected goals', 'Goal kick', 'Throw ins',
    'Goals outside the box', 'Right foot goals', 'Left foot goals', 'Headed goals',
    'Penalty goals', 'Direct free kick goals', 'Season'
]

# ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
df_points_filtered = df_points[points_cols]
df_details_filtered = df_details[details_cols]

# Ø§Ù„Ø¯Ù…Ø¬ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Match ID Ùˆ Player
df_merged = pd.merge(df_points_filtered, df_details_filtered,
                     on=['Match ID', 'Player'],
                     how='left')

# Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ù…Ø¬
df_merged.head()

from openpyxl import load_workbook

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ
book = load_workbook(file_path)

# Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø´ÙŠØª Ø¬Ø¯ÙŠØ¯ Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù
with pd.ExcelWriter(file_path, engine='openpyxl', mode='a', if_sheet_exists='replace') as writer:
    df_merged.to_excel(writer, sheet_name='Player_Performance_Clean_Merged', index=False)

print("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ ÙÙŠ Ø´ÙŠØª Ø¬Ø¯ÙŠØ¯.")

# Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© Ù„ÙƒÙ„ Ø¹Ù…ÙˆØ¯
missing_values = df.isnull().sum().sort_values(ascending=False)
print("Missing values per column:\n", missing_values)

# Ø±Ø³Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© (Ù„Ù„ØªÙˆØ¶ÙŠØ­)
missing_values.plot(kind='bar', figsize=(12,6), color='skyblue')
plt.title('Missing Values per Column')
plt.ylabel('Number of Missing Values')
plt.xlabel('Columns')
plt.show()

# Ø±Ø³Ù… ØªÙˆØ²ÙŠØ¹ Ù†Ù‚Ø§Ø· Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
plt.figure(figsize=(10,6))
sns.histplot(df['Points'], kde=True, bins=30)
plt.title('Distribution of Player Points')
plt.xlabel('Points')
plt.ylabel('Frequency')
plt.show()

# ØªØ­Ù‚Ù‚ Ø³Ø±ÙŠØ¹ Ù…Ù† Ø¨Ø¹Ø¶ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©
df[df['Points'].isnull()].head(10)

# ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙÙ‚ÙˆØ¯Ø© Ù…Ù† Points
missing_points = df[df['Points'].isnull()]
print("Missing Points shape:", missing_points.shape)
print(missing_points[['Match ID', 'Player']].head(10))

# ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙÙ‚ÙˆØ¯Ø© Ù…Ù† Minutes played
missing_minutes = df[df['Minutes played'].isnull()]
print("Missing Minutes played shape:", missing_minutes.shape)
print(missing_minutes[['Match ID', 'Player']].head(10))

# Outer Merge
df_merged_outer = pd.merge(df_points_filtered, df_details_filtered,
                           on=['Match ID', 'Player'],
                           how='outer', indicator=True)

# ÙØ­Øµ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¯Ù…Ø¬
print(df_merged_outer['_merge'].value_counts())

# ØªÙ†ÙÙŠØ° Ø¯Ù…Ø¬ Ø¯Ø§Ø®Ù„ÙŠ Inner Merge Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø© ÙÙ‚Ø·
df_final_clean = pd.merge(df_points_filtered, df_details_filtered,
                          on=['Match ID', 'Player'],
                          how='inner')

# ØªØ­Ù‚Ù‚ Ø³Ø±ÙŠØ¹ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©
print(df_final_clean.isnull().sum())

# Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸ÙŠÙØ© ÙˆØ§Ù„ÙƒØ§Ù…Ù„Ø©
df_final_clean.to_excel('/content/drive/MyDrive/Hakathon/Final_Clean_Player_Performance.xlsx', index=False)

print("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸ÙŠÙØ© ÙˆØ§Ù„ÙƒØ§Ù…Ù„Ø© (121,608 Ø³Ø¬Ù„) Ø¨Ù†Ø¬Ø§Ø­.")

""" (Optimal Formation Model)"""

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
import pandas as pd
import numpy as np
from sklearn.cluster import KMeans
import matplotlib.pyplot as plt
import seaborn as sns

# Ù…Ø³Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸ÙŠÙØ©
file_path = '/content/drive/MyDrive/Hakathon/Final_Clean_Player_Performance.xlsx'

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
df = pd.read_excel(file_path)

# Ø¹Ø±Ø¶ Ø³Ø±ÙŠØ¹
df.head()

# Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø¯ÙŠØ© Ø§Ù„ØªÙŠ ÙŠÙØªÙˆÙ‚Ø¹ ØªØ£Ø«ÙŠØ±Ù‡Ø§ ÙÙŠ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
numeric_cols = [
    'Points', 'Minutes played', 'Goals 10', 'Shots on target 4', 'Shots off target 2',
    'Interceptions 2', 'Fouls won 1', 'Fouls conceded -1', 'Yellow cards -2', 'Red cards -5',
    'Goals conceded (Player=-1, GK=-6)', 'Penalties won 4', 'Saves (Player=0, GK=5)',
    'Penalties saved (Player=0, GK=5)', 'Accurate Passes', 'Expected goals', 'Assists',
    'Shots inside the box', 'Shots outside the box', 'Headed shots'
]

# Ø¥Ù†Ø´Ø§Ø¡ DataFrame Ù…Ø®ØµØµ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·
df_corr = df[numeric_cols]

# ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙ… Ù…ÙÙ‚ÙˆØ¯Ø©
df_corr.dropna(inplace=True)

# Ø¹Ø±Ø¶ Ø³Ø±ÙŠØ¹
df_corr.head()

# Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø¯ÙŠØ© Ø§Ù„ØªÙŠ ÙŠÙØªÙˆÙ‚Ø¹ ØªØ£Ø«ÙŠØ±Ù‡Ø§ ÙÙŠ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
numeric_cols = [
    'Points', 'Minutes played', 'Goals 10', 'Shots on target 4', 'Shots off target 2',
    'Interceptions 2', 'Fouls won 1', 'Fouls conceded -1', 'Yellow cards -2', 'Red cards -5',
    'Goals conceded (Player=-1, GK=-6)', 'Penalties won 4', 'Saves (Player=0, GK=5)',
    'Penalties saved (Player=0, GK=5)', 'Accurate Passes', 'Expected goals',
    'Shots inside the box', 'Shots outside the box', 'Headed shots'
]

# Check if 'Assists' column exists, and include it if it does
if 'Assists' in df.columns:
    numeric_cols.append('Assists')

# Ø¥Ù†Ø´Ø§Ø¡ DataFrame Ù…Ø®ØµØµ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·
df_corr = df[numeric_cols]

# ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙ… Ù…ÙÙ‚ÙˆØ¯Ø©
df_corr.dropna(inplace=True)

# Ø¹Ø±Ø¶ Ø³Ø±ÙŠØ¹
df_corr.head()

# Ø­Ø³Ø§Ø¨ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·
corr_matrix = df_corr.corr()

# Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ (Ø­Ø±Ø§Ø±ÙŠ)
plt.figure(figsize=(14, 10))
sns.heatmap(corr_matrix, annot=True, cmap='coolwarm', fmt=".2f", linewidths=0.5)
plt.title('Correlation Matrix for Player Performance Metrics')
plt.show()

selected_features = [
    'Goals 10',
    'Shots on target 4',
    'Minutes played',
    'Accurate Passes',
    'Expected goals',
    'Shots inside the box',
    'Shots outside the box',
    'Shots off target 2',
    'Fouls won 1'
]

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestRegressor
import joblib

# Ù…Ø³Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸ÙŠÙØ©
file_path = '/content/drive/MyDrive/Hakathon/Final_Clean_Player_Performance.xlsx'

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
df = pd.read_excel(file_path)

# Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ±Ù„ÙŠØ´Ù†
selected_features = [
    'Goals 10',
    'Shots on target 4',
    'Minutes played',
    'Accurate Passes',
    'Expected goals',
    'Shots inside the box',
    'Shots outside the box',
    'Shots off target 2',
    'Fouls won 1'
]

df_model = df[selected_features + ['Player', 'Team', 'Position', 'Points']]

# Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©
df_model.dropna(inplace=True)

# Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨
X = df_model[selected_features]
y = df_model['Points']

# ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
rf_model = RandomForestRegressor(n_estimators=100, random_state=42)
rf_model.fit(X, y)

# Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
joblib.dump(rf_model, 'player_performance_model.pkl')

# ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ†Ø¨Ø¤
def predict_optimal_team(team1, team2, match_location, df_model, rf_model):
    # ÙÙ„ØªØ±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„ÙƒÙ„ ÙØ±ÙŠÙ‚
    team1_players = df_model[df_model['Team'] == team1].copy()
    team2_players = df_model[df_model['Team'] == team2].copy()

    # Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„ Ø£ÙØ¶Ù„ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨ Ø¹Ù„Ù‰ Ø£Ø±Ø¶ Ø§Ù„Ù…Ù„Ø¹Ø¨
    if match_location == team1:
        team1_players['Home'] = 1
        team2_players['Home'] = 0
    else:
        team1_players['Home'] = 0
        team2_players['Home'] = 1

    # ØªÙˆÙ‚Ø¹ Ù†Ù‚Ø§Ø· Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    team1_players['Predicted Points'] = rf_model.predict(team1_players[selected_features])
    team2_players['Predicted Points'] = rf_model.predict(team2_players[selected_features])

    # Ø§Ø®ØªÙŠØ§Ø± Ø£ÙØ¶Ù„ 11 Ù„Ø§Ø¹Ø¨Ù‹Ø§ Ù„ÙƒÙ„ ÙØ±ÙŠÙ‚
    optimal_team1 = team1_players.sort_values('Predicted Points', ascending=False).head(11)
    optimal_team2 = team2_players.sort_values('Predicted Points', ascending=False).head(11)

    return optimal_team1[['Player', 'Position', 'Predicted Points']], optimal_team2[['Player', 'Position', 'Predicted Points']]

# ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ†Ø¨Ø¤ Ø§Ù„Ù…ÙØ­Ø³Ù†Ø© (Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†)
def predict_optimal_team_no_duplicates(team1, team2, match_location, df_model, rf_model):
    # ÙÙ„ØªØ±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„ÙƒÙ„ ÙØ±ÙŠÙ‚
    team1_players = df_model[df_model['Team'] == team1].copy()
    team2_players = df_model[df_model['Team'] == team2].copy()

    # Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·
    team1_players['Predicted Points'] = rf_model.predict(team1_players[selected_features])
    team2_players['Predicted Points'] = rf_model.predict(team2_players[selected_features])

    # Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨Ø£Ø®Ø° Ø£ÙØ¶Ù„ Ø£Ø¯Ø§Ø¡ Ù…ØªÙˆÙ‚Ø¹ Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨
    team1_players_unique = team1_players.loc[team1_players.groupby('Player')['Predicted Points'].idxmax()]
    team2_players_unique = team2_players.loc[team2_players.groupby('Player')['Predicted Points'].idxmax()]

    # Ø§Ø®ØªÙŠØ§Ø± Ø£ÙØ¶Ù„ 11 Ù„Ø§Ø¹Ø¨Ù‹Ø§ Ù…Ù† ÙƒÙ„ ÙØ±ÙŠÙ‚
    optimal_team1 = team1_players_unique.sort_values(by='Predicted Points', ascending=False).head(11)
    optimal_team2 = team2_players_unique.sort_values(by='Predicted Points', ascending=False).head(11)

    return optimal_team1[['Player', 'Position', 'Predicted Points']], optimal_team2[['Player', 'Position', 'Predicted Points']]

# Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨ÙˆØ¶ÙˆØ­
team1 = input("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„: ")
team2 = input("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ: ")
match_location = input("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø°ÙŠ Ø³ØªÙ‚Ø§Ù… Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø¹Ù„Ù‰ Ø£Ø±Ø¶Ù‡: ")

optimal_team1, optimal_team2 = predict_optimal_team_no_duplicates(team1, team2, match_location, df_model, rf_model)

# Ø¹Ø±Ø¶ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±
print("\nâš½ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„ÙØ±ÙŠÙ‚", team1)
print(optimal_team1.to_string(index=False))

print("\nâš½ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„ÙØ±ÙŠÙ‚", team2)
print(optimal_team2.to_string(index=False))

import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestRegressor

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
df = pd.read_excel('/content/drive/MyDrive/Hakathon/Final_Clean_Player_Performance.xlsx')

# Ø§Ø®ØªÙŠØ§Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ³Ù… 2024/2025 ÙÙ‚Ø·
df_recent = df[df['Season'] == '2024/2025'].copy()

# Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
df_recent.head()

selected_features = [
    'Goals 10',
    'Shots on target 4',
    'Minutes played',
    'Accurate Passes',
    'Expected goals',
    'Shots inside the box',
    'Shots outside the box',
    'Shots off target 2',
    'Fouls won 1'
]

df_model = df_recent[selected_features + ['Player', 'Team', 'Position', 'Points']]
df_model.dropna(inplace=True)

X = df_model[selected_features]
y = df_model['Points']

rf_model = RandomForestRegressor(n_estimators=100, random_state=42)
rf_model.fit(X, y)

def suggest_multiple_formations(team_name, df_model, rf_model):
    team_players = df_model[df_model['Team'] == team_name].copy()
    team_players['Predicted Points'] = rf_model.predict(team_players[selected_features])

    # Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨Ø£ÙØ¶Ù„ Ø£Ø¯Ø§Ø¡ Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨
    team_players_unique = team_players.loc[team_players.groupby('Player')['Predicted Points'].idxmax()]

    formations = {
        'Ù‡Ø¬ÙˆÙ…ÙŠØ© (4-3-3)': {'GK':1, 'DF':4, 'MF':3, 'FW':3},
        'Ù…ØªÙˆØ§Ø²Ù†Ø© (4-4-2)': {'GK':1, 'DF':4, 'MF':4, 'FW':2},
        'Ø¯ÙØ§Ø¹ÙŠØ© (5-4-1)': {'GK':1, 'DF':5, 'MF':4, 'FW':1}
    }

    suggested_formations = {}

    for formation, positions in formations.items():
        selected_players = pd.DataFrame()

        for position, count in positions.items():
            position_players = team_players_unique[team_players_unique['Position'] == position]
            top_players = position_players.nlargest(count, 'Predicted Points')
            selected_players = pd.concat([selected_players, top_players])

        suggested_formations[formation] = selected_players[['Player', 'Position', 'Predicted Points']]

    return suggested_formations

Ø¨
team_name = input("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©: ")

formations_suggestions = suggest_multiple_formations(team_name, df_model, rf_model)

# Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ø¨ÙˆØ¶ÙˆØ­
for formation_name, players in formations_suggestions.items():
    print(f"\nğŸ“Œ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© {formation_name} Ù„ÙØ±ÙŠÙ‚ {team_name}:")
    print(players.to_string(index=False))

# Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªÙˆØ³Ø· Ù‚ÙˆØ© Ø§Ù„ÙØ±Ù‚
team_strength = df_model.groupby('Team')['Points'].mean().reset_index()
team_strength.columns = ['Team', 'Team_Strength']

# Ø¯Ù…Ø¬ Ø§Ù„Ù‚ÙˆØ© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
df_model = pd.merge(df_model, team_strength, on='Team', how='left')

# Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªÙˆØ³Ø· Ù‚ÙˆØ© Ø§Ù„ÙØ±Ù‚
team_strength = df_model.groupby('Team')['Points'].mean().reset_index()
team_strength.columns = ['Team', 'Avg_Team_Strength'] # Changed column name

# Ø¯Ù…Ø¬ Ø§Ù„Ù‚ÙˆØ© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
df_model = pd.merge(df_model, team_strength, on='Team', how='left')

# Ø¥Ø¶Ø§ÙØ© Ù…ØªØºÙŠØ± Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© (Home/Away)
df_model['Home_Away'] = np.random.choice(['Home', 'Away'], size=len(df_model))

# Ø¥Ø¶Ø§ÙØ© Ù…ØªØºÙŠØ± Ø¯ÙŠØ±Ø¨ÙŠ (Yes/No)
df_model['Derby'] = np.random.choice(['Yes', 'No'], size=len(df_model))

# ØªØ­ÙˆÙŠÙ„ Home_Away Ùˆ Derby Ø¥Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù…
df_model = pd.get_dummies(df_model, columns=['Home_Away', 'Derby'], drop_first=True)

# ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
extended_features = selected_features + ['Team_Strength', 'Home_Away_Home', 'Derby_Yes']

# ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
X_extended = df_model[extended_features]
y = df_model['Points']

advanced_rf_model = RandomForestRegressor(n_estimators=100, random_state=42)
advanced_rf_model.fit(X_extended, y)

def advanced_formation_suggestion_unique(my_team, opponent_team, match_location, derby, df_model, advanced_rf_model):
    my_players = df_model[df_model['Team'] == my_team].copy()

    # ØªØ­Ø¯ÙŠØ¯ Ù‚ÙˆØ© Ø§Ù„Ø®ØµÙ…
    opponent_strength = df_model[df_model['Team'] == opponent_team]['Team_Strength'].mean()

    # Ø¥Ù†Ø´Ø§Ø¡ DataFrame Ù…Ø¤Ù‚Øª Ù„ØªÙˆÙ‚Ø¹ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙŠ Ø¸Ø±ÙˆÙ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
    my_players['Opponent_Strength'] = opponent_strength
    my_players['Home_Away_Home'] = 1 if match_location == 'Home' else 0
    my_players['Derby_Yes'] = 1 if derby == 'Yes' else 0

    # ØªÙˆÙ‚Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    my_players['Predicted Points'] = advanced_rf_model.predict(my_players[extended_features])

    # Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø£Ø®Ø° Ø£ÙØ¶Ù„ Ø£Ø¯Ø§Ø¡ Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©
    my_players_unique = my_players.loc[my_players.groupby('Player')['Predicted Points'].idxmax()]

    # Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© (Ø­Ø§Ø±Ø³ + 10 Ù„Ø§Ø¹Ø¨ÙŠÙ†)
    positions_required = {'GK':1, 'DF':4, 'MF':3, 'FW':3}

    final_squad = pd.DataFrame()

    for position, count in positions_required.items():
        position_players = my_players_unique[my_players_unique['Position'] == position]
        top_players = position_players.sort_values('Predicted Points', ascending=False).head(count)
        final_squad = pd.concat([final_squad, top_players])

    # Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø£ÙŠ Ù„Ø§Ø¹Ø¨
    final_squad = final_squad.drop_duplicates(subset=['Player'])

    return final_squad[['Player', 'Position', 'Predicted Points']]

# ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ø¢Ù† Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±
my_team = input("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙØ±ÙŠÙ‚Ùƒ: ")
opponent_team = input("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…: ")
match_location = input("Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© (Home/Away): ")
derby = input("Ù‡Ù„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø¯ÙŠØ±Ø¨ÙŠ (Yes/No): ")

final_squad_unique = advanced_formation_suggestion_unique(my_team, opponent_team, match_location, derby, df_model, advanced_rf_model)

print("\nğŸ“Œ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© (Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±):")
print(final_squad_unique.to_string(index=False))

def advanced_formation_both_teams(team1, team2, match_location, derby, df_model, advanced_rf_model):

    def get_squad(team, opponent):
        players = df_model[df_model['Team'] == team].copy()
        opponent_strength = df_model[df_model['Team'] == opponent]['Team_Strength'].mean()

        players['Opponent_Strength'] = opponent_strength
        players['Home_Away_Home'] = 1 if match_location == team else 0
        players['Derby_Yes'] = 1 if derby == 'Yes' else 0

        players['Predicted Points'] = advanced_rf_model.predict(players[extended_features])

        players_unique = players.loc[players.groupby('Player')['Predicted Points'].idxmax()]

        positions_required = {'GK':1, 'DF':4, 'MF':3, 'FW':3}
        squad = pd.DataFrame()

        for position, count in positions_required.items():
            position_players = players_unique[players_unique['Position'] == position]
            top_players = position_players.sort_values('Predicted Points', ascending=False).head(count)
            squad = pd.concat([squad, top_players])

        return squad[['Player', 'Position', 'Predicted Points']].drop_duplicates(subset=['Player'])

    # ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„
    team1_squad = get_squad(team1, team2)

    # ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ
    team2_squad = get_squad(team2, team1)

    return team1_squad, team2_squad

# ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø¹ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ†
my_team = input("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙØ±ÙŠÙ‚Ùƒ: ")
opponent_team = input("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…: ")
match_location = input(f"Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© ({my_team}/{opponent_team}): ")
derby = input("Ù‡Ù„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø¯ÙŠØ±Ø¨ÙŠ (Yes/No): ")

team1_squad, team2_squad = advanced_formation_both_teams(my_team, opponent_team, match_location, derby, df_model, advanced_rf_model)

# Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ø¨ÙˆØ¶ÙˆØ­
print(f"\nâš½ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„ÙØ±ÙŠÙ‚ {my_team}:")
print(team1_squad.to_string(index=False))

print(f"\nâš½ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„ÙØ±ÙŠÙ‚ {opponent_team}:")
print(team2_squad.to_string(index=False))

import matplotlib.pyplot as plt
import matplotlib.patches as patches
import numpy as np

# ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ù…Ù„Ø¹Ø¨ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
import requests
from io import BytesIO
from PIL import Image

url = "https://www.pinterest.com/pin/full-hd-football-field-background-football-field-empty-scene-top-shot-free-download-image--871235490392341667/" # ØµÙˆØ±Ø© Ù…Ù„Ø¹Ø¨ ÙˆØ§Ø¶Ø­Ø©
response = requests.get(url)
field_img = Image.open(BytesIO(response.content))

plt.imshow(field_img)
plt.axis('off')
plt.show()